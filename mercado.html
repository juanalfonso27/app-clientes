<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Precios de granos en Paraguay</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      background-color: #f0f2f5;
      color: #333;
      margin: 0;
      padding: 0;
    }

    .header {
      background-color: #d4d4d4;
      padding: 12px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .header-icon {
      cursor: pointer;
      background: none;
      border: none;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 4px;
      color: #555;
    }

    .header-icon svg {
      width: 22px;
      height: 22px;
      stroke: currentColor;
      stroke-width: 1.8;
      fill: none;
      stroke-linecap: round;
      stroke-linejoin: round;
    }

    .logo {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .logo img {
      height: 36px;
      width: auto;
    }


    .navbar {
      background-color: #ffffff;
      padding: 10px 20px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      display: flex;
      justify-content: center;
      gap: 30px;
    }

    .navbar a {
      text-decoration: none;
      color: #555;
      font-weight: 500;
      padding: 8px 15px;
      border-radius: 6px;
      transition: background-color 0.3s, color 0.3s;
    }

    .navbar a:hover, .navbar a.active {
      background-color: #e7f1ff;
      color: #0B57D0;
    }

    header {
      background: #0B57D0;
      color: white;
      padding: 25px 20px;
      text-align: center;
    }

    header h1 {
      margin: 0;
      font-size: 2em;
    }

    header p {
      margin: 5px 0 0;
      opacity: 0.9;
    }

    main {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      padding: 20px;
      max-width: 1200px;
      margin: 20px auto;
    }

    .grano {
      background: white;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.04);
      transition: transform 0.3s, box-shadow 0.3s;
    }

    .grano:hover {
      transform: translateY(-5px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.08);
    }

    .grano h2 {
      margin-top: 0;
      color: #0B57D0;
      font-size: 1.5em;
      border-bottom: 2px solid #f0f0f0;
      padding-bottom: 10px;
      margin-bottom: 20px;
    }

    .dato {
      margin: 10px 0;
      font-size: 1em;
      color: #555;
    }

    .precio {
      font-size: 2.2em;
      font-weight: bold;
      color: #084298; /* Darker blue */
      margin: 20px 0;
    }

    .variacion {
      padding: 4px 8px;
      border-radius: 4px;
      display: inline-block;
      font-weight: bold;
      font-size: 0.9em;
    }

    .positivo {
      background-color: #cfe2ff; /* Light blue */
      color: #084298; /* Dark blue */
    }

    .negativo {
      background-color: #f8d7da; /* Light red */
      color: #c62828;
    }

    .loading {
      color: #666;
      font-style: italic;
      font-size: 0.8em;
    }

    .status {
      text-align: center;
      padding: 15px;
      font-size: 0.9em;
      color: #666;
      background-color: #fff;
      border-bottom: 1px solid #eee;
    }

    footer {
      text-align: center;
      padding: 20px;
      background: #e9ecef;
      font-size: 0.8em;
      color: #6c757d;
    }
  </style>
</head>
<body>
  <!-- Header con logo -->
  <div class="header">
    <a href="homenoticias.html" class="header-icon" aria-label="Volver a Inicio">
      <svg viewBox="0 0 24 24">
        <path d="M15 18l-6-6 6-6"></path>
      </svg>
    </a>
    <div class="logo">
      <img src="logo1.png" alt="IASA logo" loading="lazy">
    </div>
    <a href="perfil.html" class="header-icon" aria-label="Mi Perfil">
      <svg viewBox="0 0 24 24">
        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
        <circle cx="12" cy="7" r="4"></circle>
      </svg>
    </a>
  </div>


  <header>
    <h1>üåæ Precio de granos en Paraguay</h1>
    <p>Cotizaciones CBOT en tiempo real</p>
  </header>

  <div class="status" id="status">Conectando...</div>

  <main>
    <section class="grano">
      <h2>Soja (CBOT)</h2>
      <div class="precio" id="SOY-price">
        <span class="loading">Cargando...</span>
      </div>
      <div class="dato">
        <strong>Variaci√≥n:</strong> <span id="SOY-change">‚Äî</span>
      </div>
      <div class="dato">
        <strong>√öltima actualizaci√≥n:</strong> <span id="SOY-time">‚Äî</span>
      </div>
    </section>

    <section class="grano">
      <h2>Ma√≠z (CBOT)</h2>
      <div class="precio" id="CORN-price">
        <span class="loading">Cargando...</span>
      </div>
      <div class="dato">
        <strong>Variaci√≥n:</strong> <span id="CORN-change">‚Äî</span>
      </div>
      <div class="dato">
        <strong>√öltima actualizaci√≥n:</strong> <span id="CORN-time">‚Äî</span>
      </div>
    </section>

    <section class="grano">
      <h2>Trigo (CBOT)</h2>
      <div class="precio" id="WHEAT-price">
        <span class="loading">Cargando...</span>
      </div>
      <div class="dato">
        <strong>Variaci√≥n:</strong> <span id="WHEAT-change">‚Äî</span>
      </div>
      <div class="dato">
        <strong>√öltima actualizaci√≥n:</strong> <span id="WHEAT-time">‚Äî</span>
      </div>
    </section>
  </main>

  <footer>
    Fuente: Yahoo Finance (CBOT) v√≠a proxy CORS ‚Äî Los datos pueden tener un retraso de 15-20 minutos
  </footer>

  <script>
    // S√≠mbolos de Yahoo Finance para futuros de CBOT
    const symbols = {
      SOY: 'ZS=F',    // Soja
      CORN: 'ZC=F',   // Ma√≠z
      WHEAT: 'ZW=F'   // Trigo
    };

    // Conversi√≥n de cents/bushel a USD/tonelada
    const conversion = {
      SOY: 36.7437,    // 1 bushel soja = 60 lbs = 27.216 kg
      CORN: 39.3683,   // 1 bushel ma√≠z = 56 lbs = 25.4 kg
      WHEAT: 36.7437   // 1 bushel trigo = 60 lbs = 27.216 kg
    };

    async function fetchQuote(symbol) {
      try {
        // Usando proxy CORS gratuito
        const url = `https://corsproxy.io/?https://query1.finance.yahoo.com/v8/finance/chart/${symbol}?interval=1d&range=1d`;
        const response = await fetch(url);
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const data = await response.json();
        const quote = data.chart.result[0];
        const meta = quote.meta;
        
        // Obtener el precio actual y el cierre anterior
        const currentPrice = meta.regularMarketPrice || meta.previousClose;
        const previousClose = meta.chartPreviousClose || meta.previousClose;
        
        // Verificar que los valores existen
        if (!currentPrice || !previousClose) {
          console.error(`Datos incompletos para ${symbol}`, meta);
          return null;
        }
        
        const change = currentPrice - previousClose;
        const changePct = (change / previousClose) * 100;
        
        return {
          price: currentPrice,
          previousClose: previousClose,
          change: change,
          changePct: changePct,
          timestamp: meta.regularMarketTime || Math.floor(Date.now() / 1000)
        };
      } catch (error) {
        console.error(`Error fetching ${symbol}:`, error);
        return null;
      }
    }

    function updateGrano(id, data, conversionFactor) {
      if (!data) {
        document.getElementById(`${id}-price`).innerHTML = '<span class="loading">Error al cargar</span>';
        return;
      }

      // Convertir de cents/bushel a USD/tonelada
      const priceInTons = data.price * conversionFactor;
      const changeInTons = data.change * conversionFactor;
      
      document.getElementById(`${id}-price`).textContent = `$${priceInTons.toFixed(2)}`;
      
      const sign = data.change >= 0 ? '+' : '';
      const variationClass = data.change >= 0 ? 'positivo' : 'negativo';
      
      document.getElementById(`${id}-change`).innerHTML = 
        `<span class="variacion ${variationClass}">${sign}${changeInTons.toFixed(2)} (${sign}${data.changePct.toFixed(2)}%)</span>`;
      
      const date = new Date(data.timestamp * 1000);
      document.getElementById(`${id}-time`).textContent = date.toLocaleString('es-PY');
    }

    async function refreshAll() {
      const statusEl = document.getElementById('status');
      statusEl.textContent = 'Actualizando precios...';
      
      try {
        let successCount = 0;
        
        for (const [key, symbol] of Object.entries(symbols)) {
          const data = await fetchQuote(symbol);
          updateGrano(key, data, conversion[key]);
          if (data) successCount++;
          // Pausa entre peticiones
          await new Promise(resolve => setTimeout(resolve, 300));
        }
        
        if (successCount > 0) {
          const now = new Date().toLocaleTimeString('es-PY');
          statusEl.textContent = `‚úì √öltima actualizaci√≥n: ${now}`;
        } else {
          statusEl.textContent = '‚ö† Error al conectar con el servidor';
        }
      } catch (error) {
        console.error('Error al actualizar:', error);
        statusEl.textContent = '‚ö† Error en la actualizaci√≥n';
      }
    }

    // Actualizar al cargar y cada 60 segundos
    refreshAll();
    setInterval(refreshAll, 60000);
  </script>
</body>
</html>
<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Precios de granos en Paraguay</title>

  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background-color: #f0f2f5;
      color: #333;
      margin: 0;
      padding: 0;
    }

    .header {
      background-color: #d4d4d4;
      padding: 12px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .header-icon svg {
      width: 22px;
      height: 22px;
      stroke: currentColor;
      stroke-width: 1.8;
      fill: none;
      stroke-linecap: round;
      stroke-linejoin: round;
    }

    .logo img {
      height: 36px;
      width: auto;
    }

    header {
      background: #0B57D0;
      color: white;
      padding: 25px 20px;
      text-align: center;
    }

    header h1 {
      margin: 0;
      font-size: 2em;
    }

    .status {
      text-align: center;
      padding: 15px;
      font-size: 0.9em;
      color: #666;
      background-color: #fff;
      border-bottom: 1px solid #eee;
    }

    .section-title {
      background: #2f2f2f;
      color: white;
      padding: 10px;
      font-size: 14px;
      font-weight: bold;
      margin-top: 25px;
      text-transform: uppercase;
      border-radius: 4px 4px 0 0;
    }

    .tabla-container {
      background: white;
      border: 1px solid #ccc;
      border-top: none;
      margin-bottom: 20px;
      overflow: hidden;
    }

    table.tabla {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
    }

    .tabla th {
      background: #f8f9fa;
      padding: 10px;
      text-align: left;
      font-weight: bold;
      border-bottom: 1px solid #ddd;
    }

    .tabla td {
      padding: 10px;
      border-bottom: 1px solid #efefef;
    }

    .var {
      font-weight: bold;
    }

    .positive {
      color: #0a8a0a;
    }

    .negative {
      color: #d00000;
    }

    /* Widget Responsive Investing */
    .widget-responsive {
      width: 100%;
      max-width: 425px;
      margin: 0 auto;
      overflow: hidden;
      position: relative;
    }

    .widget-responsive iframe {
      transform-origin: top left;
    }

    footer {
      text-align: center;
      padding: 20px;
      background: #e9ecef;
      font-size: 0.8em;
      color: #6c757d;
    }
  </style>
</head>

<body>

  <!-- Header -->
  <div class="header">
    <a href="homenoticias.html" class="header-icon">
      <svg viewBox="0 0 24 24">
        <path d="M15 18l-6-6 6-6"></path>
      </svg>
    </a>

    <div class="logo">
      <img src="logo1.png" alt="IASA logo">
    </div>

    <a href="perfil.html" class="header-icon">
      <svg viewBox="0 0 24 24">
        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
        <circle cx="12" cy="7" r="4"></circle>
      </svg>
    </a>
  </div>

  <header>
    <h1>Cotizaciones CBOT</h1>
  </header>

  <div class="status" id="status">Conectando...</div>

  <!-- MAIN -->
  <main>

    <!-- WIDGET INVESTING -->
    <div class="section-title">Resumen Técnico</div>

    <div class="tabla-container" style="padding: 15px; text-align:center;">
      <div class="widget-responsive">
        <iframe id="investing-frame" frameborder="0" scrolling="no" height="253" width="425" allowtransparency="true"
          src="https://ssltools.investing.com/technical_summary.php?pairs=8916,8917,8918,13916,961618&curr-name-color=%230059B0&fields=5m,1h,1d&force_lang=4">
        </iframe>
      </div>

      <div style="font-size:11px;margin-top:8px;">
        Resumen técnico por <a href="https://es.investing.com" target="_blank">Investing.com</a>
      </div>
    </div>

    <!-- NUEVO WIDGET TRADINGVIEW FUNCIONAL -->
    <div class="section-title">Commodities internacionales</div>

  <div class="tabla-container" style="padding:10px;">
  <div class="tradingview-widget-container">
    <div class="tradingview-widget-container__widget"></div>

    <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-market-overview.js" async>
    {
      "colorTheme": "light",
      "dateRange": "12M",
      "showChart": true,
      "locale": "es",
      "width": "100%",
      "height": "450",
      "tabs": [
        {
          "title": "Commodities",
          "symbols": [
            { "s": "CBOT:ZS1!", "d": "Soja" },
            { "s": "CBOT:ZC1!", "d": "Maíz" },
            { "s": "CBOT:ZW1!", "d": "Trigo" },
            { "s": "NYMEX:CL1!", "d": "Petróleo WTI" },
            { "s": "COMEX:GC1!", "d": "Oro" }
          ]
        }
      ]
    }
    </script>
  </div>
</div>

    <!-- TABLA DE PRECIOS (YAHOO FINANCE) -->
    <div class="section-title">Cotizaciones en Tiempo Real (Tabla)</div>

    <div class="tabla-container">
      <table class="tabla" id="widgetCommodities">
        <thead>
          <tr>
            <th>Contrato</th>
            <th>Último</th>
            <th>Var. %</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Soja Chicago</td>
            <td id="soy_last">Cargando...</td>
            <td id="soy_var">—</td>
          </tr>
          <tr>
            <td>Maíz Chicago</td>
            <td id="corn_last">Cargando...</td>
            <td id="corn_var">—</td>
          </tr>
          <tr>
            <td>Trigo Chicago</td>
            <td id="wheat_last">Cargando...</td>
            <td id="wheat_var">—</td>
          </tr>
          <tr>
            <td>Petróleo WTI</td>
            <td id="oil_last">Cargando...</td>
            <td id="oil_var">—</td>
          </tr>
          <tr>
            <td>Oro</td>
            <td id="gold_last">Cargando...</td>
            <td id="gold_var">—</td>
          </tr>
        </tbody>
      </table>
    </div>

  </main>

  <!-- SCRIPT RESIZE INVESTING -->
  <script>
    function resizeWidget() {
      const container = document.querySelector('.widget-responsive');
      const iframe = document.getElementById('investing-frame');

      const originalWidth = 425;
      const currentWidth = container.offsetWidth || originalWidth;
      const scale = currentWidth / originalWidth;

      iframe.style.transform = `scale(${scale})`;
      iframe.style.width = originalWidth + "px";
      iframe.style.height = (253 * scale) + "px";
    }

    window.addEventListener('resize', resizeWidget);
    window.addEventListener('load', resizeWidget);
  </script>

  <!-- SCRIPT YAHOO FINANCE -->
  <script>
    const tickers = {
      soy: "ZS=F",
      corn: "ZC=F",
      wheat: "ZW=F",
      oil: "CL=F",
      gold: "GC=F"
    };

    async function getQuote(symbol) {
      try {
        const url = `https://corsproxy.io/?https://query1.finance.yahoo.com/v8/finance/chart/${symbol}?interval=1d&range=1d`;
        const res = await fetch(url);
        const json = await res.json();

        const quote = json.chart.result[0];
        const prices = quote.indicators.quote[0];

        const price = prices.close[prices.close.length - 1];
        const open = prices.open[0] || price;
        const pct = ((price - open) / open) * 100;

        return { price, pct };
      } catch {
        return null;
      }
    }

    function updateRow(id, data) {
      const lastEl = document.getElementById(id + "_last");
      const varEl = document.getElementById(id + "_var");

      if (!data) {
        lastEl.textContent = "—";
        varEl.textContent = "—";
        return;
      }

      lastEl.textContent = data.price.toFixed(2);
      varEl.textContent = (data.pct >= 0 ? "+" : "") + data.pct.toFixed(2) + "%";
      varEl.style.color = data.pct >= 0 ? "green" : "red";
    }

    async function refreshWidgetClone() {
      for (const id in tickers) {
        const data = await getQuote(tickers[id]);
        updateRow(id, data);
      }
    }

    refreshWidgetClone();
    setInterval(refreshWidgetClone, 60000);
  </script>

</body>
</html>
